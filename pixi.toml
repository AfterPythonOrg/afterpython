[workspace]
authors = ["softwareentrepreneer <softwareentrepreneer+afterpython@gmail.com>"]
channels = ["conda-forge"]
name = "afterpython"
platforms = ["osx-arm64", "linux-64"]
version = "0.0.1.dev2"

[tasks]
dev = "cd frontend && pnpm dev"
add = { cmd = "uv add {{ lib }} && pixi add --pypi {{ lib }}", args = ["lib"] }
remove = { cmd = "uv remove {{ lib }} && pixi remove --pypi {{ lib }}", args = ["lib"] }
lock = "uv lock && pixi lock"
install = "uv sync --all-extras --all-groups && pixi install"
clean = "rm -rf ./afterpython/_build"
build-watch = { cmd = "cd frontend && pnpm build:watch", depends-on = ["clean"] }
build = { cmd = "cd frontend && pnpm build && cd .. && uv build", depends-on = ["clean"] }
preview = "cd frontend && pnpm preview"
publish = { cmd = "uv publish", depends-on = ["build"] }

[tasks.test-all]
depends-on = [
  { task = "test", environment = "py311" },
  { task = "test", environment = "py312" },
  { task = "test", environment = "py313" },
  # { task = "test", environment = "py314" },
]

[dependencies]
python = ">=3.11"
uv = ">=0.8.17"
nodejs = ">=22.14.0"
pnpm = ">=10.11.1"

[pypi-dependencies]
click = ">=8.1.8"
trogon = ">=0.6.0"
mystmd = { version = ">=1.6.1", extras = ["execute"] }
marimo = { version = ">=0.15.5", extras = ["recommended"] }

[environments]
py311 = ["py311", "test"]
py312 = ["py312", "test"]
py313 = ["py313", "test"]
# py314 = ["py314", "test"]

[feature.test.dependencies]
pytest = ">=8.4.1"
pytest-cov = ">=6.2.1"
pytest-mock = ">=3.14.1"
pytest-xdist = ">=3.8.0"
[feature.test.tasks]
test = "pytest"

[feature.py311.dependencies]
python = "3.11.*"

[feature.py312.dependencies]
python = "3.12.*"

[feature.py313.dependencies]
python = "3.13.*"

# [feature.py314.dependencies]
# python = "3.14.*"